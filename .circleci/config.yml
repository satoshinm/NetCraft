version: 2
jobs:
    build:
        docker:
            - image: buildpack-deps:xenial
        environment:
            EMSCRIPTEN: /usr/share/emscripten
        working_directory: ~/NetCraft
        steps:
            - checkout
            - run: 
                name: Setup dependencies
                command: |
                  apt update
                  apt install -y cmake libglew-dev xorg-dev libcurl4-openssl-dev
                  apt install -y libglfw3-dev
                  mkdir native-build
                  (cd native-build && cmake ..)
                  
                  apt install -y emscripten
                  mkdir release-build-js
                  (cd release-build-js && cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=$EMSCRIPTEN/cmake/Modules/Platform/Emscripten.cmake ..)
            - run:
                name: native-build
                command: cd native-build && make
            - run:
                name: release-build-js
                command: cd release-build-js && make


